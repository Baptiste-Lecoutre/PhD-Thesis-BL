% LaTeX PSL thesis cover template
% Copyright (c) 2018, Pierre Guillou
% All rights reserved.
%
% This program is free software: you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation, either version 3 of the License, or
% (at your option) any later version.
%
% This program is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
% See the GNU General Public License for more details.
%
% You should have received a copy of the GNU General Public License
% along with this program.
% If not, see <http://www.gnu.org/licenses/>.

\NeedsTeXFormat{LaTeX2e}

\ProvidesPackage{ups-cover}

\RequirePackage{tabularx}
\RequirePackage{etoolbox}
\RequirePackage{iftex}
\RequirePackage{tikz}
\usetikzlibrary{backgrounds}

\definecolor{pslblue}{RGB}{36, 56, 141}
\definecolor{Prune}{RGB}{99,0,60}

\newcommand*{\institute}[1]{\gdef\@institute{#1}}
\newcommand*{\specialty}[1]{\gdef\@specialty{#1}}
\newcommand*{\doctoralschool}[3]{
  \gdef\@doctoralschoolname{#1}%
  \gdef\@doctoralschoolnumber{#2}
  \gdef\@doctoralschoolsigle{#3}
}
\newcommand*{\NNT}[1]{\gdef\@NNT{#1}}

%% default values
\newcommand*{\@institute}{IOGS}
\newcommand*{\@specialty}{Sp\'{e}cialit\'{e} de l'ED}
\newcommand*{\@doctoralschoolname}{Nom de l'ED}
\newcommand*{\@doctoralschoolnumber}{XXX}
\newcommand*{\@doctoralschoolsigle}{ED}
\newcommand*{\@NNT}{NNT}

\newcommand{\jurymember}[4]{
  \ifnum#1=1
  \gdef\@jiname{#2}\gdef\@jitt{#3}\gdef\@jirole{#4}
  \fi
  \ifnum#1=2
  \gdef\@jiiname{#2}\gdef\@jiitt{#3}\gdef\@jiirole{#4}
  \fi
  \ifnum#1=3
  \gdef\@jiiiname{#2}\gdef\@jiiitt{#3}\gdef\@jiiirole{#4}
  \fi
  \ifnum#1=4
  \gdef\@jivname{#2}\gdef\@jivtt{#3}\gdef\@jivrole{#4}
  \fi
  \ifnum#1=5
  \gdef\@jvname{#2}\gdef\@jvtt{#3}\gdef\@jvrole{#4}
  \fi
  \ifnum#1=6
  \gdef\@jviname{#2}\gdef\@jvitt{#3}\gdef\@jvirole{#4}
  \fi
  \ifnum#1=7
  \gdef\@jviiname{#2}\gdef\@jviitt{#3}\gdef\@jviirole{#4}
  \fi
  \ifnum#1=8
  \gdef\@jviiiname{#2}\gdef\@jviiitt{#3}\gdef\@jviiirole{#4}
  \fi
  \ifnum#1=9
  \gdef\@jixname{#2}\gdef\@jixtt{#3}\gdef\@jixrole{#4}
  \fi
  \ifnum#1=10
  \gdef\@jxname{#2}\gdef\@jxtt{#3}\gdef\@jxrole{#4}
  \fi
  \ifnum#1=11
  \gdef\@jxiname{#2}\gdef\@jxitt{#3}\gdef\@jxirole{#4}
  \fi
  \ifnum#1=12
  \gdef\@jxiiname{#2}\gdef\@jxiitt{#3}\gdef\@jxiirole{#4}
  \fi
}

%% empty default values
\newcommand*{\@jiname}{} \newcommand*{\@jitt}{} \newcommand*{\@jirole}{}
\newcommand*{\@jiiname}{} \newcommand*{\@jiitt}{} \newcommand*{\@jiirole}{}
\newcommand*{\@jiiiname}{} \newcommand*{\@jiiitt}{} \newcommand*{\@jiiirole}{}
\newcommand*{\@jivname}{} \newcommand*{\@jivtt}{} \newcommand*{\@jivrole}{}
\newcommand*{\@jvname}{} \newcommand*{\@jvtt}{} \newcommand*{\@jvrole}{}
\newcommand*{\@jviname}{} \newcommand*{\@jvitt}{} \newcommand*{\@jvirole}{}
\newcommand*{\@jviiname}{} \newcommand*{\@jviitt}{} \newcommand*{\@jviirole}{}
\newcommand*{\@jviiiname}{} \newcommand*{\@jviiitt}{} \newcommand*{\@jviiirole}{}
\newcommand*{\@jixname}{} \newcommand*{\@jixtt}{} \newcommand*{\@jixrole}{}
\newcommand*{\@jxname}{} \newcommand*{\@jxtt}{} \newcommand*{\@jxrole}{}
\newcommand*{\@jxiname}{} \newcommand*{\@jxitt}{} \newcommand*{\@jxirole}{}
\newcommand*{\@jxiiname}{} \newcommand*{\@jxiitt}{} \newcommand*{\@jxiirole}{}

\newcommand*{\upsassetspath}[1]{\gdef\@upsassetspath{#1}}
\newcommand*{\@upsassetspath}{.}

\newcommand{\frabstract}[1]{\long\gdef\@frabstract{#1}}
\newcommand*{\@frabstract}{}
\newcommand{\thefrabstract}{\@frabstract}
\newcommand{\enabstract}[1]{\long\gdef\@enabstract{#1}}
\newcommand*{\@enabstract}[1]{}
\newcommand{\theenabstract}{\@enabstract}
\newcommand*{\frkeywords}[1]{\gdef\@frkeywords{#1}}
\newcommand*{\@frkeywords}{\par}
\newcommand{\thefrkeywords}{\@frkeywords}
\newcommand{\enkeywords}[1]{\gdef\@enkeywords{#1}}
\newcommand*{\@enkeywords}[1]{\par}
\newcommand{\theenkeywords}{\@enkeywords}
\newcommand{\frtitle}[1]{\long\gdef\@frtitle{#1}}
\newcommand*{\@frtitle}{}
\newcommand{\thefrtitle}{\@frtitle}
\newcommand{\entitle}[1]{\long\gdef\@entitle{#1}}
\newcommand*{\@entitle}{}
\newcommand{\theentitle}{\@entitle}

\ifLuaTeX{}
\newfontfamily\upsfont{arial}
\newenvironment{upsfontenv}{\upsfont}{\par}
\else
\fi
\ifXeTeX{}
\newfontfamily\upsfont{Arial}
\newenvironment{upsfontenv}{\upsfont}{\par}
\else
\fi
\ifPDFTeX{}
\newenvironment{upsfontenv}{\fontfamily{phv}\selectfont}{\par}
\else
\fi

\newif\if@nomaketitle\@nomaketitlefalse
\DeclareOption{nomaketitle}{
  \@nomaketitletrue
}

\newif\if@cotutelle\@cotutellefalse
\DeclareOption{cotutelle}{
  \@cotutelletrue
}

\ProcessOptions{}\relax{}

\if@nomaketitle
\else
%% Override \maketitle to directly insert cover
\renewcommand*{\maketitle}{
  \upscover{}
}
\fi

\if@cotutelle
\newcommand{\entitle}[1]{\gdef\@entitle{#1}}
\newcommand{\otherinstitute}[1]{\gdef\@otherinstitute{#1}}
\newcommand{\logootherinstitute}[1]{\gdef\@logootherinstitute{#1}}
\fi

%% Whole UPS cover, front + back
\newcommand*{\upscover}{
  \AfterPreamble{\upsfrontcover{}}
  \AtEndDocument{\upsbackcover{}}
}

%% Front UPS cover
\newcommand*{\upsfrontcover}{
%\begin{comment} 
  \begin{upsfontenv}
    \thispagestyle{empty}
    \begin{tikzpicture}[overlay, remember picture,
      text centered, align=center]

      %% bandeau gauche UPS
      \node[xshift=-1.5mm, anchor=west]
      at (current page.west) {\includegraphics{Fig/Bandeau_UPaS.pdf}};
      
      %% NNT
      \node[xshift=2.6cm, yshift=2cm, anchor=south west] at (current page.south west) {
      {\color{white} \rotatebox{90}{NNT: \@NNT}}
      };
      
      %% thesis title
      \node[yshift=-5cm, xshift=-1cm, anchor=north east] (thesistitle) at (current page.north east) {
        \begin{minipage}[h]{\paperwidth-8.5cm}
          \flushright
          \fontsize{22}{26}\selectfont
          {\color{Prune}\textbf{\@title{}}}\unskip\strut\par
        \end{minipage}
      };

	  %% thèse de doctorat de l'université paclay-saris
      \node[yshift=-1cm, anchor=north east] at (thesistitle.south east) {
	  \begin{minipage}[h]{\paperwidth-8.5cm}      
      \flushright\normalsize
      {\color{black}\textbf{Thèse de doctorat de l'Université Paris-Saclay}\unskip\strut\par
	  \vspace{1mm}      
      préparée à l'\@institute{}\unskip\strut\par}
	  \end{minipage}      
      };
      
      %% doctoral school
      \node[yshift=-3cm, anchor=north east] at (thesistitle.south east) {
      \begin{minipage}[h]{\paperwidth-8.5cm} 
        \flushright\normalsize
        {\color{black}\'{E}cole doctorale n\textsuperscript{o}\@doctoralschoolnumber{} \@doctoralschoolname{} (\@doctoralschoolsigle{})\unskip\strut\par
        \vspace{1mm}
Spécialité de doctorat: \@specialty{}\unskip\strut\par}
	  \end{minipage}
      };
      
     
      %% author
      \node[yshift=-5cm, anchor=north east] (author) at (thesistitle.south east) {
        \begin{minipage}[h]{\paperwidth-8.5cm}
        \flushright\normalsize
          \textbf{Thèse présentée et soutenue à Palaiseau, le \@date{}, par}\unskip\strut\par
          \bigskip
          {\Large\color{Prune}\selectfont\textbf{\@author{}}}\unskip\strut\par
        \end{minipage}
      };


      %% jury
      \node[fill=lightgray!40, xshift=-0.3333em, yshift=-2cm, anchor=north east] at (author.south east) {
        \begin{minipage}[ht]{\paperwidth-8.5cm}
          \vspace{2mm}
          {\hspace{2mm}\color{Prune}\fontsize{12}{15}\selectfont \textbf{Composition du jury :}}%

          \vspace{5mm}
          %\hspace{-2mm}
          \fontsize{9}{11}\selectfont
          \arrayrulecolor{Prune}
          \begin{tabularx}{\paperwidth-8.5cm}{|p{9cm}X}
            \textbf{\@jiname} & {\@jirole} \\
            {\@jitt} & \\[6mm]
            \textbf{\@jiiname} & {\@jiirole} \\
            {\@jiitt} & \\[6mm]
            \textbf{\@jiiiname} & {\@jiiirole} \\
            {\@jiiitt} & \\[6mm]
            \textbf{\@jivname} & {\@jivrole} \\
            {\@jivtt} & \\[6mm]
          \end{tabularx}
          \arrayrulecolor{lightgray!40}
          \begin{tabularx}{\paperwidth-8.5cm}{|p{9cm}X}
            \textbf{\@jvname} & {\@jvrole} \\
            {\@jvtt} & \\[6mm]
            \textbf{\@jviname} & {\@jvirole} \\
            {\@jvitt} & \\
          %  \upsjurystyle{\@jviiname}{\@jviitt}{\@jviirole}
          %  \upsjurystyle{\@jviiiname}{\@jviiitt}{\@jviiirole}
          %  \upsjurystyle{\@jixname}{\@jixtt}{\@jixrole}
          %  \upsjurystyle{\@jxname}{\@jxtt}{\@jxrole}
          %  \upsjurystyle{\@jxiname}{\@jxitt}{\@jxirole}
          %  \upsjurystyle{\@jxiiname}{\@jxiitt}{\@jxiirole}
          \end{tabularx}
          %\vspace{-3mm}
        \end{minipage}
      };
      
      
      
      %% node origin
      \coordinate (o) at (current page.center);
%      %% PSL institute logo
%      \node[xshift=-56mm, yshift=-124mm] at (o) {
%        \includegraphics[scale=.4]{\@upsassetspath/logo-ens.png}
%      };

%      %% other institute logo (cotutelle)
%      \if@cotutelle
%      \node[xshift=65mm, yshift=125mm] at (o) {
%        \includegraphics[height=1.8cm]{\@logootherinstitute}
%      };
%      \fi

    \end{tikzpicture}
  \end{upsfontenv}
  \clearpage
  \mbox{}
  \thispagestyle{empty}
  \clearpage
  \setcounter{page}{1}
%  \end{comment}
}

%% Back PSL cover
\newcommand*{\upsbackcover}{
  \pagestyle{empty}
  \cleardoublepage{}
  \ifodd\value{page}\hbox{}\newpage\fi
  \begin{upsfontenv}

    \begin{tikzpicture}[overlay, remember picture,
      text centered, align=center]

      %% node origin
      \coordinate (o) at (current page.center);

      %% EDOM logo
      \node[xshift=2cm, yshift=-1.5cm, anchor=north west] at (current page.north west)
      {\includegraphics[height=2.45cm]{Fig/EDOM.png}};


	   %% UPS stuff en bas
	   \fontfamily{fvs}\fontseries{m}\selectfont
	   \node[yshift=2.5cm, xshift=1.5cm, anchor=south west] at (current page.south west)
	   {\begin{tabular}{p{15.3cm}r}
		\multirow{3}{16cm}[+0mm]{{\color{Prune} Université Paris-Saclay\\
		Espace Technologique / Immeuble Discovery\\
		Route de l’Orme aux Merisiers RD 128 / 91190 Saint-Aubin, France}} & \multirow{3}		{2.19cm}[+9mm]{\includegraphics[height=2.19cm]{Fig/e.png}}\\
		\end{tabular}    };
%



		%% Partie française
		\node[draw=Prune, line width=1, inner sep=10pt, inner ysep=10pt, yshift=-5cm, xshift=2cm-5pt, anchor=north west] (frpart) at (current page.north west) {
		\begin{minipage}[ht]{\paperwidth-4cm-20pt}
		\fontfamily{rm}\selectfont
		{\bf Titre: } \@frtitle{}\unskip\strut\par %Titre
		\medskip
		{\bf Mots clés: } {\small \@frkeywords{}}\unskip\strut\par
		\vspace{-2mm}		
		\begin{multicols}{2}
		{\bf Résumé: } {\small \@frabstract{}}
		\end{multicols}
      
		\end{minipage}
		};


		%% Partie anglaise
		\node[draw=Prune, line width=1, inner sep=10pt, inner ysep=10pt, yshift=-1cm, anchor=north west] (enpart) at (frpart.south west) {
		\begin{minipage}[ht]{\paperwidth-4cm-20pt}
		\fontfamily{rm}\selectfont
		{\bf Title: } \@entitle{}\unskip\strut\par %Titre
		\medskip
		{\bf Keywords: } {\small \@enkeywords{}}\unskip\strut\par
		\vspace{-2mm}		
		\begin{multicols}{2}
		{\bf Abstract: } {\small \@enabstract{}}
		\end{multicols}
      
		\end{minipage}
		};

    \end{tikzpicture}
  \end{upsfontenv}
}

%% Some text styling
\newcommand{\upsbluelabel}[1]{{\color{Prune}\fontsize{12}{15}\selectfont #1}}
\newcommand{\upsjurystyle}[3]{
  \ifdefempty{#1}{}{
    \fontsize{10}{12}\selectfont #1 & \\
    #2 & \emph{#3} \\[3.5mm]
  }
}
\newcommand{\upsbacknode}[4]{
  \begin{minipage}[ht]{.8\paperwidth}
    {\color{Prune}\fontsize{12}{15}\selectfont #1}\unskip\strut\par
    \vspace{-2.5mm}
    \tikz{\draw[Prune, line width=.5mm] (0, 0) -- (16.8, 0);}

    \vspace{3mm}
    {\color{black}\fontsize{#3}{#4}\selectfont #2}\unskip\strut\par
  \end{minipage}
}

\endinput
